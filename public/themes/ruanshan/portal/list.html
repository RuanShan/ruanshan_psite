<!DOCTYPE html>
<html>
<head>
    <title>{$category.name} {$category.seo_title} {$site_info.site_name|default=''}</title>
    <meta name="keywords" content="{$category.seo_keywords},{$site_info.site_seo_keywords|default=''}"/>
    <meta name="description" content="{$category.seo_description},{$site_info.site_seo_description|default=''}">
    <include file="public@head"/>
    <hook name="before_head_end"/>
</head>
<body class="body-white">
<include file="public@header"/>
<div class="container">
  <widget name="article_categories">
  <div class="filters middle cates">
    <div class="clearfix">
      <div class=" ">
        <php>
          $widget["vars"]["articles_category_root_id"] = empty($widget["vars"]["articles_category_root_id"])?1:$widget["vars"]["articles_category_root_id"];
          $is_root_selected = ($widget["vars"]["articles_category_root_id"]==$category['id']);
          $all_category_ids = array();
          if($is_root_selected){  array_push($all_category_ids, $category['id']); }
        </php>

        <ul class="filter-section category">
          <li> <a class="button button-no-round category-tab {$is_root_selected? 'is-checked': ''}" data-filter="*" href="{:cmf_url('portal/List/index',['id'=>$category['id']])}">全部</a></li></li>

          <portal:allsubcategories categoryId="$widget.vars.articles_category_root_id">
           <li class="button-group" data-filter-group="category">
             <a class="button button-no-round category-tab {$vo.id==$category.id? 'is-checked': ''}" data-filter="*" href="{:cmf_url('portal/List/index',['id'=>$vo['id']])}">{$vo.name}</a></li>
             <php> if($is_root_selected){ array_push($all_category_ids, $vo['id']);  } </php>
           </portal:allsubcategories>
         </ul>

      </div>
    </div>
  </div>
  </widget>

    <h2>{$category.name}</h2>
    <div class="row">
        <div class="col-md-12">
            <div class="">
                <php>
                    $where= function($query){
                        $query->where('post.create_time','egt',0);
                    };
                    $page=[
                        'list_rows'=>10,
                        'next'=>'下一页',
                        'prev'=>'上一页'
                    ];
                </php>
                <portal:articles item="vo" where="$where" order="post.create_time DESC" page="$page"
                                 relation="categories"
                                 categoryIds="$all_category_ids"
                                 returnVarName="articles_data">
                    <div class="list-boxes">
                        <h2><a href="{:cmf_url('portal/Article/index',array('id'=>$vo['id'],'cid'=>$category['id']))}">{$vo.post_title}</a>
                        </h2>
                        <p>{$vo.post_excerpt}</p>
                        <div>
                            <div class="pull-left">
                                <div class="list-actions">
                                    <a href="javascript:;"><i class="fa fa-eye"></i><span>{$vo.post_hits}</span></a>
                                    <a href="{:url('portal/Article/doLike',array('id'=>$vo['id']))}"
                                       class="js-count-btn"><i class="fa fa-thumbs-up"></i><span class="count">{$vo.post_like}</span></a>
                                    <a href="{:url('user/Favorite/add',array('id'=>$vo['id'],'cid'=>$category['id']))}"
                                       class="js-favorite-btn"
                                       data-id="{$vo.id}"
                                       data-table="portal_post"
                                       data-title="{:base64_encode($vo.post_title)}"
                                       data-url="{:cmf_url_encode('portal/Article/index',array('id'=>$vo['id'],'cid'=>$category['id']))}"
                                    >
                                        <i class="fa fa-star-o"></i>
                                    </a>
                                </div>
                            </div>
                            <a class="btn btn-warning btn-sm pull-right"
                               href="{:cmf_url('portal/Article/index',array('id'=>$vo['id'],'cid'=>$category['id']))}">查看更多</a>
                        </div>
                    </div>
                </portal:articles>

            </div>
            <ul class="pagination">
                <page/>
            </ul>
        </div>

    </div>

</div>
<include file="public@footer"/>

<include file="public@scripts"/>
<script src="__TMPL__/public/assets/js/opage.js"></script>
<hook name="before_body_end"/>
</body>
</html>
